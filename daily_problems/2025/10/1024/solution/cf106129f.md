**提示 1：** 对于一个确定的边长，如何判断是否成立？

**提示 2：** 哪些边长是值得检查的？

对于某个确定的边长，直接顺序遍历，遇到一个 `'#'` 的时候，暴力检查右下角的正方形中是否存在非 `'#'` 并染色为 `'.'` ，如果出边界或不符合条件则直接不成立。注意不成立时及时推出循环。

因为每个位置最多查一次，所以这么做的时间复杂度是 $\mathcal{O}(nm)$ 的。

如果直接检查所有边长是不符合要求的，那怎么办呢？

对于某一行连续的 `'#'` ，假设长度为 $k$ ，则答案一定是 $k$ 的因子，否则凑不出来这一行。所以枚举这个数的因子就好。

这么做的时间复杂度为 $\mathcal{O}(nmd(\min(n, m)))$ ， $d(x)$ 表示不超过 $x$ 的数的因子最大个数，我们可以选择横着 / 竖着的最短的一段。下面的代码并非完全按照上面的思路实现。

其实也可以用从 $1$ 开始不断乘质数（这个质数是 $k$ 的质因子）的方式不断得到最大值，这样可以降低复杂度到 $\mathcal{O}(nm\log\min(n,m))$ ，但这不是必要的。

### 具体代码如下——

Python 做法如下——

```Python []
def main(): 
    n, m = MII()
    grid = [[1 if c == '#' else 0 for c in I()] for _ in range(n)]
    total = sum(sum(x) for x in grid)
    
    tmp = [[0] * m for _ in range(n)]
    
    for i in range(fmin(n, m), 0, -1):
        if total % (i * i) == 0:
            for x in range(n):
                for y in range(m):
                    tmp[x][y] = grid[x][y]
            
            flg = True
            for x in range(n):
                for y in range(m):
                    if tmp[x][y]:
                        for dx in range(x, x + i):
                            for dy in range(y, y + i):
                                if dx >= n or dy >= m or tmp[dx][dy] == 0:
                                    flg = False
                                    break
                                tmp[dx][dy] = 0
                            if not flg: break
                        if not flg: break
                if not flg: break
            
            if flg:
                print(i)
                break
```

C++ 做法如下——

```cpp []
int main() {
	ios_base::sync_with_stdio(false);
	cin.tie(0);
	cout.tie(0);

	int n, m;
	cin >> n >> m;

	vector<string> grid(n);
	for (auto &s: grid) cin >> s;

	int total = 0;
	for (auto &s: grid) {
		for (auto &c: s) {
			total += (c == '#');
		}
	}

	vector<vector<int>> tmp(n, vector<int>(m, 0));
	for (int i = min(n, m); i > 0; i --) {
		if (total % (i * i) == 0) {

			for (int x = 0; x < n; x ++) {
				for (int y = 0; y < m; y ++) {
					if (grid[x][y] == '#') {
						tmp[x][y] = 1;
					}
				}
			}

			bool flg = true;
			for (int x = 0; x < n; x ++) {
				for (int y = 0; y < m; y ++) {
					if (tmp[x][y]) {
						for (int dx = x; dx < x + i; dx ++) {
							for (int dy = y; dy < y + i; dy ++) {
								if (dx >= n || dy >= m || !tmp[dx][dy]) {
									flg = false;
									break;
								}
								tmp[dx][dy] = 0;
							}
							if (!flg) break;
						}
						if (!flg) break;
					}
				}
				if (!flg) break;
			}

			if (flg) return cout << i, 0;
		}
	}

	return 0;
}
```